<!DOCTYPE html>
<html>
<head>
  <title>T맵 오버레이 단독 실험</title>
  
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'unsafe-inline' 'unsafe-eval' https://apis.openapi.sk.com https://*.tmap.co.kr;
    connect-src 'self'; 
    style-src 'self' 'unsafe-inline';
    font-src 'self';
    img-src 'self' data: https://*.daumcdn.net https://*.tmap.sk.com https://*.tmap.co.kr;
    frame-src 'self' blob:; 
  ">
  
  <script src="https://apis.openapi.sk.com/tmap/jsv2?version=1&appKey=QePeg5ee414bGfjbIx13L55PmUEim1vl9tvBSyp0"></script>
  
  <style>
    html, body { height: 100%; margin: 0; padding: 0; font-family: sans-serif; }
    
    /* [3] 오버레이 (처음엔 숨겨짐) */
    #map-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5); /* 반투명 배경 */
      display: none; /* [핵심] 처음엔 숨김 */
      z-index: 100;
    }
    
    #map-container {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 80%;
      height: 80%;
      background: white;
      border: 2px solid red;
    }
    
    #map_div { width: 100%; height: 100%; }
    
    #close-button {
      position: absolute;
      top: 10px;
      right: 10px;
      padding: 10px;
      background: white;
      border: 1px solid black;
      cursor: pointer;
      z-index: 200;
    }
  </style>
</head>
<body>

  <h1>T맵 오버레이 실험실</h1>
  <button id="open-button" style="padding: 20px; font-size: 20px;">
    오버레이로 지도 띄우기
  </button>

  <div id="map-overlay">
    <button id="close-button">닫기</button>
    <div id="map-container">
      <div id="map_div"></div>
    </div>
  </div>

  <script>
    let isMapInitialized = false; // [5] 맵이 로드됐는지 확인하는 '깃발'

    // [6] '오버레이 열기' 버튼
    document.getElementById('open-button').onclick = function() {
      // 오버레이를 화면에 표시
      document.getElementById('map-overlay').style.display = 'block';
      
      // 맵이 아직 안 만들어졌으면 (isMapInitialized == false 이면)
      if (!isMapInitialized) {
        console.log("맵이 없으므로, 지금부터 생성합니다...");
        try {
          // <head>에서 로드한 Tmapv2를 사용해 지도를 그림
          new Tmapv2.Map("map_div", {
            center: new Tmapv2.LatLng(35.2128, 128.9806),
            width: "100%",
            height: "100%",
            zoom: 12
          });
          
          isMapInitialized = true; // '깃발'을 세움 (다음부턴 생성 안 함)
          console.log("지도 생성 성공!");
          
        } catch (e) {
          console.error("지도 생성 실패:", e);
          document.getElementById('map_div').textContent = "지도 생성 실패: " + e.message;
        }
      } else {
        console.log("이미 맵이 있으므로, 그냥 보여주기만 합니다.");
      }
    };

    // [7] '닫기' 버튼
    document.getElementById('close-button').onclick = function() {
      document.getElementById('map-overlay').style.display = 'none';
    };
  </script>
</body>
</html>
